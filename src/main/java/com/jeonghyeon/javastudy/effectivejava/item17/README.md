# Item17. 변경 가능성을 최소화하라

* 다양한 불변 클래스들
  * String
  * 기본 타입의 박싱된 클래스들
  * BigInteger
  * BigDecimal

### 클래스를 불변으로 만드는 규칙
1. 객체의 상태를 변경하는 메서드(변경자)를 제공하지 않는다.
2. 클래스를 확장할 수 없도록 한다.
   1. 하위 클래스에서 부주의하게 또는 나쁜 의도로 객체의 상태를 변하게 만드는 사태를 막아준다.
```java
public class Complex{
    private final double re;
    private final double im;
    
    private Complex(double re, double im){
        this.re = re;
        this.im = im;
    }
    
    public static Complex valueOf(double re, double im){
        return new Complex(re, im);
    }
}
```

3. 모든 필드를 final로 선언한다.
4. 모든 필드를 private으로 선언한다.
5. 자신 외에는 내부의 가변 컴포넌트에 접근할 수 없도록 한다.

### 불변 객체 장점
1. 불변 객체는 단순하다.
   1. 불변 객체는 생성된 시점 상태를 소멸될 때까지 그대로 간직할 수 있다.
   2. 모든 생성자가 클래스 불변식을 보장한다면 그 클래스를 사용하는 프로그래머가 다른 노력을 들이지 않아도 영원히 불변이다.
2. 불변 객체는 근복적으로 스레드 안전하여 따로 동기화할 필요 없다
   1. 여러 스레드가 동시에 사용해도 절대 훼손되지 않는다.
3. 불변 객체는 안심하고 공유할 수 있다.
   1. 방어적 복사할 필요도 없고 clone 메서드나 복사 생성자를 제공하지 않는게 좋다
   2. String 클래스의 복사 생성자는 이 사실을 잘 이해하지 못한 자바 초창기 때 만들어진 것으로, 되도록 사용하지 말자
4. 불변 객체는 자유롭게 공유할 수 있음은 물론, 불변 객체끼리는 내부 데이터를 공유할 수 있다.
5. 객체를 만들 때 다른 불변 객체들을 구성요소로 사용하면 이점이 많다
   1. Map의 key 또는 Set의 원소로
6. 불변 객체는 그 자체로 '메서드에서 예외가 발생한 후에도 그 객체는 여전히 유효한 상태여야 한다'를 제공한다

### 불변 객체 단점
1. 값이 다르면 반드시 독립된 객체로 만들어야 한다.
   1. 값의 가짓수가 많다면 이들을 모두 만드는 데 큰 비용을 치러야 한다. 

### 요약
* getter가 있다고 해서 무조건 setter 만들지 마라
* 클래스는 꼭 필요한 경우가 아니라면 불변이어야 한다.(단점은 잠재적 성능 저하 뿐이다)
* 불변으로 만들 수 없는 클래스라도 변경할 수 있는 부분을 최소한으로 줄이자.
  * 객체가 가질수 있는 상태의 수를 줄이면 그 객체를 예측하기 쉬워지고 오류가 생길 가능성이 줄어든다.
  * 꼭 변경해야 할 필드를 뺀 나머지 모두를 final로 선언
    * 아직 제대로 이해하지 못함... 나중에 다시 [이해 못함] 
* 생성자는 불젼식 설정이 모두 완료된, 초기화가 완벽히 끝난 상태의 객체를 생성해야 한다.